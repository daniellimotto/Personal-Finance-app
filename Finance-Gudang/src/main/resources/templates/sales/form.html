<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head><title>Sale Form</title>
<script>
function updateTotal() {
  const qty = parseFloat(document.getElementById('quantity').value) || 0;
  const price = parseFloat(document.getElementById('pricePerQuantity').value) || 0;
  document.getElementById('totalAmount').value = (qty * price).toFixed(2);
}
</script>
</head>
<body>
<h2 th:text="${sale.id == null ? 'New Sale' : 'Edit Sale'}"></h2>
<form th:action="@{/sales}" method="post">
    <input type="hidden" name="id" th:value="${sale.id}"/>

    Code: <input type="text" name="code" th:value="${sale.code}" required/><br/>

    Company: <input type="text" name="companyName" list="companyList" th:value="${sale.company != null ? sale.company.name : ''}" placeholder="Type or select company"/>
    <datalist id="companyList">
      <option th:each="c : ${companyOptions}" th:value="${c.name}"></option>
    </datalist><br/>

    Buyer: <input type="text" name="buyerName" list="buyerList" th:value="${sale.buyer != null ? sale.buyer.name : ''}" placeholder="Type or select buyer"/>
    <datalist id="buyerList">
      <option th:each="b : ${buyerOptions}" th:value="${b.name}"></option>
    </datalist><br/>

    Product: <input type="text" name="productName" list="productList" th:value="${sale.product != null ? sale.product.name : ''}" placeholder="Type or select product"/>
    <datalist id="productList">
      <option th:each="p : ${productOptions}" th:value="${p.name}"></option>
    </datalist><br/>

    Quantity: <input type="number" id="quantity" name="quantity" th:value="${sale.quantity}" oninput="updateTotal()"/><br/>

    Price per Quantity: <input type="number" step="0.01" id="pricePerQuantity" name="pricePerQuantity" th:value="${sale.pricePerQuantity}" oninput="updateTotal()"/><br/>

    Total Amount: <input type="number" step="0.01" id="totalAmount" name="totalAmount" th:value="${sale.totalAmount}" readonly/><br/>

    Date: <input type="date" name="purchaseDate" th:value="${sale.purchaseDate}"/><br/>

    Payment Method: <input type="text" name="paymentMethod" list="pmList" th:value="${sale.paymentMethod != null ? sale.paymentMethod.name : ''}" placeholder="Type or select method"/>
    <datalist id="pmList">
      <option th:each="pm : ${paymentMethodOptions}" th:value="${pm.name}"></option>
    </datalist><br/>

    <button type="submit">Save</button>
</form>

<a th:href="@{/sales}">Back</a>
</body>
</html>
